{"version":3,"sources":["../src/bcplayer.js"],"names":["define","$","Event","videoElements","bcAccounts","bcs","index","accountsPlayer","_slicedToArray","arr","i","_arrayWithHoles","_iterableToArrayLimit","_unsupportedIterableToArray","_nonIterableRest","TypeError","o","minLen","_arrayLikeToArray","n","Object","prototype","toString","call","slice","constructor","name","Array","from","test","len","length","arr2","Symbol","iterator","_arr","_n","_d","_e","_i","_s","next","done","push","value","err","isArray","findVideoJs","document","querySelectorAll","map","video","getAttribute","filter","self","indexOf","iterateVideoElemets","forEach","playerId","accountId","includes","setAttribute","removeAttribute","initVideosByAccount","account","player","videos","concat","videojs","id","controls","getBcModule","pl","window","requirejs","undef","config","paths","require","bc","loadAllBrightcove","_Object$entries","entries","_Object$entries$_i","key","_i2","_Object$entries2","_Object$entries2$_i","ind","val","init","on","getLegacyEvents","events","FILTER_CONTENT_UPDATED","find","addBack","each","__self","data"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JW Player module.\n *\n * @module     media_bcplayer/bcplayer\n * @package    media_bcplayer\n * @copyright  2017 Ruslan Kabalin, Lancaster University\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/event'],function($, Event) {\n\n    var videoElements;\n    var bcAccounts;\n    var bcs = {}; // The object that will contain all our 'bc' RJS modules.\n    var index = 0;\n    var accountsPlayer = []; // Change all the data-player attribute to keep Brightcove from trying to\n    /**\n     * @param arr\n     * @param i\n     * @returns {[]|any[]|unknown[]|void}\n     * @private\n     */\n    function _slicedToArray(arr, i) {\n        return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n    }\n\n    /**\n     * @private\n     */\n    function _nonIterableRest() {\n        // eslint-disable-next-line max-len\n        throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n    }\n\n    /**\n     * @param o\n     * @param minLen\n     * @returns {any[]|unknown[]}\n     * @private\n     */\n    function _unsupportedIterableToArray(o, minLen) {\n        if (!o) return;\n        if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n        var n = Object.prototype.toString.call(o).slice(8, -1);\n        if (n === \"Object\" && o.constructor) n = o.constructor.name;\n        if (n === \"Map\" || n === \"Set\") return Array.from(o);\n        if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n    }\n\n    /**\n     * @param arr\n     * @param len\n     * @returns {any[]}\n     * @private\n     */\n    function _arrayLikeToArray(arr, len) {\n        if (len == null || len > arr.length) len = arr.length;\n        for (var i = 0, arr2 = new Array(len); i < len; i++) {\n            arr2[i] = arr[i];\n        }\n        return arr2;\n    }\n\n    /**\n     * @param arr\n     * @param i\n     * @returns {[]}\n     * @private\n     */\n    function _iterableToArrayLimit(arr, i) {\n        if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n        var _arr = [];\n        var _n = true;\n        var _d = false;\n        var _e = undefined;\n        try {\n            for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n                _arr.push(_s.value);\n                if (i && _arr.length === i) break;\n            }\n        } catch (err) {\n            _d = true;\n            _e = err;\n        } finally {\n            try {\n                if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n            } finally {\n                if (_d) throw _e;\n            }\n        }\n        return _arr;\n    }\n\n    /**\n     * @param arr\n     * @returns {*}\n     * @private\n     */\n    function _arrayWithHoles(arr) {\n        if (Array.isArray(arr)) return arr;\n    }\n\n    /**\n     */\n    function findVideoJs(){\n        videoElements = document.querySelectorAll('video-js');\n        bcAccounts = Array.prototype.slice.call(videoElements).map(function (video) {\n            return video.getAttribute('data-player');\n        }).filter(function (value, index, self) {\n            return self.indexOf(value) === index;\n        });\n    }\n\n    /**\n     * initialize every player when the first script is retrieved.\n     */\n    function iterateVideoElemets() {\n        videoElements.forEach(function (video, index) {\n            var playerId = video.getAttribute('data-player');\n            var accountId = video.getAttribute('data-account');\n\n            if (accountsPlayer[accountId]) {\n                if (!accountsPlayer[accountId].includes(playerId)) {\n                    accountsPlayer[accountId].push(playerId);\n                }\n            } else {\n                accountsPlayer[accountId] = [playerId];\n            }\n            video.setAttribute('data-store-player', playerId);\n            video.removeAttribute('data-player');\n        });\n    }\n    findVideoJs();\n    iterateVideoElemets();\n    /**\n     * @param account string\n     */\n    function initVideosByAccount(account, player) {\n        var videos = document.querySelectorAll(`video-js[data-account=\"${account}\"][data-store-player=\"${player}\"]`);\n        videos.forEach(function (video) {\n            video.setAttribute('data-player', video.getAttribute('data-store-player'));\n            bcs[\"bc\".concat(account).concat(player)](video);\n            videojs(video.id).controls(true);\n        });\n\n    }\n\n    /**\n     * @param account string\n     * @param player string\n     */\n    function getBcModule(account, player) {\n        var pl = player ? player : 'default'; // Undefine 'bc' module so it can be reset using the next player's values.\n        // Because Brightcove's script forces itself to be named 'bc' when called as\n        // an AMD module, you have to undefine it before calling a second 'bc' module\n        // with a different url. Simply changing the path and requiring it won't work.\n        // It has to be undef'd before a second call can be made.\n\n        window.requirejs.undef('bc'); // Set the 'bc' module path using this video's account and player ids.\n\n        window.requirejs.config({\n            paths: {\n                'bc': \"http://players.brightcove.net/\".concat(account, \"/\").concat(pl, \"_default/index.min\")\n            }\n        }); // Get this bc module. Since it's async, get the next bc in the callback.\n\n        require(['bc'], function (bc) {\n            // Store the current bc in bcs, because we're going to undefine it.\n            bcs[\"bc\".concat(account).concat(pl)] = bc; // Initialize all the videos for this account.\n\n            initVideosByAccount(account, pl);\n            if (index < bcAccounts.length - 1) {\n                getBcModule(account, bcAccounts[++index]);\n            }\n        });\n    }\n\n    /**\n     * load Bright Cove\n     */\n    function loadAllBrightcove() {\n        for (var _i = 0, _Object$entries = Object.entries(accountsPlayer); _i < _Object$entries.length; _i++) {\n            var _Object$entries$_i = _slicedToArray(_Object$entries[_i], 2),\n                key = _Object$entries$_i[0],\n                value = _Object$entries$_i[1];\n\n            for (var _i2 = 0, _Object$entries2 = Object.entries(value); _i2 < _Object$entries2.length; _i2++) {\n                var _Object$entries2$_i = _slicedToArray(_Object$entries2[_i2], 2),\n                    ind = _Object$entries2$_i[0],\n                    val = _Object$entries2$_i[1];\n                getBcModule(key, val);\n            }\n        }\n    }\n\n    // Load all accounts and related players\n    return {\n        init: function() {\n            loadAllBrightcove();\n\n            $(document).on('brightcoveinsertedtodom',function (event) {\n                findVideoJs();\n                iterateVideoElemets();\n                loadAllBrightcove();\n            });\n\n\n            Event.getLegacyEvents().done(function (events) {\n                $(document).on(events.FILTER_CONTENT_UPDATED, function (event) {\n                    $(\".editor_atto_wrap\").find('video-js').addBack('video-js').each(function () {\n                        var __self = $(this);\n                        getBcModule(__self.data('account'), __self.data('player'));\n                    });\n                });\n            });\n        }\n\n    };\n\n});\n"],"file":"bcplayer.min.js"}